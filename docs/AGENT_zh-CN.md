# 基于大语言模型的智能代理（ReAct）

## 什么是智能体（ReAct）？

智能体是一种高级人工智能系统，以大型语言模型（LLM）作为其核心计算引擎。它将大型语言模型的推理能力与规划和工具使用等附加功能相结合，以自主执行复杂任务。智能体能够分解复杂查询，生成逐步解决方案，并与外部工具或API交互以收集信息或执行子任务。

本示例使用 [ReAct（推理 + 行动）](https://www.promptingguide.ai/techniques/react) 方法实现了一个智能体。ReAct 使智能体能够通过在迭代反馈循环中结合推理和行动来解决复杂任务。智能体反复经历三个关键步骤：思考、行动和观察。它使用大型语言模型分析当前情况，决定下一步要采取的行动，使用可用的工具或API执行该行动，并从观察到的结果中学习。这个持续的过程使智能体能够适应动态环境，提高任务解决的准确性，并提供具有上下文感知的解决方案。

## 使用示例

ReAct 代理可以应用于各种场景，提供准确且高效的解决方案。

### 文本转SQL

用户询问"上一季度的总销售额"。代理解释此请求，将其转换为SQL查询，针对数据库执行查询，并展示结果。

### 财务预测

一位财务分析师需要预测下一季度的收入。代理收集相关数据，使用财务模型执行必要的计算，并生成详细的预测报告，确保预测的准确性。

## 使用代理功能

要为您的自定义聊天机器人启用代理功能，请按照以下步骤操作：

1. 导航到自定义机器人界面中的代理部分。

2. 在代理部分，您将看到可供代理使用的工具列表。默认情况下，所有工具都是禁用的。

3. 要激活工具，只需切换所需工具旁边的开关。一旦工具被启用，代理将可以访问并在处理用户查询时使用它。

![](./imgs/agent_tools.png)

> [!重要]
> 需要注意的是，在代理部分启用任何工具都将自动将["知识"功能](https://aws.amazon.com/what-is/retrieval-augmented-generation/)也视为一个工具。这意味着大语言模型将自主决定是否使用"知识"来回答用户查询，并将其视为可用工具之一。

4. 默认提供"互联网搜索"工具。此工具允许代理从互联网获取信息以回答用户问题。

![](./imgs/agent1.png)
![](./imgs/agent2.png)

此工具依赖于 [DuckDuckGo](https://duckduckgo.com/)，它有速率限制。它适合概念验证或演示目的，但如果您想在生产环境中使用，我们建议使用另一个搜索 API。

5. 您可以开发和添加自己的自定义工具以扩展代理的功能。有关创建和集成自定义工具的更多信息，请参考[如何开发您自己的工具](#how-to-develop-your-own-tools)部分。

## 如何开发自己的工具

要为 Agent 开发自定义工具，请遵循以下指南：

- 创建一个继承自 `AgentTool` 类的新类。尽管接口与 LangChain 兼容，但此示例实现提供了自己的 `AgentTool` 类，您应该从中继承（[源代码](../backend/app/agents/tools/agent_tool.py)）。

- 参考 [BMI 计算工具](../examples/agents/tools/bmi/bmi.py)的示例实现。此示例演示了如何创建一个根据用户输入计算身体质量指数（BMI）的工具。

  - 在工具上声明的名称和描述在 LLM 考虑应使用哪个工具来响应用户问题时使用。换句话说，它们被嵌入到调用 LLM 的提示中。因此建议尽可能精确地描述。

- [可选] 开发自定义工具后，建议使用测试脚本（[示例](../examples/agents/tools/bmi/test_bmi.py)）验证其功能。此脚本将帮助您确保工具按预期工作。

- 完成自定义工具的开发和测试后，将实现文件移动到 [backend/app/agents/tools/](../backend/app/agents/tools/) 目录。然后打开 [backend/app/agents/utils.py](../backend/app/agents/utils.py) 并编辑 `get_available_tools`，以便用户可以选择开发的工具。

- [可选] 为前端添加清晰的名称和描述。此步骤是可选的，但如果不执行此步骤，将使用工具中声明的工具名称和描述。这些是为 LLM 准备的，而不是为用户，因此建议添加专门的解释以获得更好的用户体验。

  - 编辑国际化文件。打开 [en/index.ts](../frontend/src/i18n/en/index.ts) 并在 `agent.tools` 中添加您自己的 `name` 和 `description`。
  - 同时编辑 `xx/index.ts`。其中 `xx` 代表您希望的国家/地区代码。

- 运行 `npx cdk deploy` 部署您的更改。这将使您的自定义工具在自定义机器人屏幕中可用。

## 贡献

**欢迎为工具仓库做出贡献！** 如果您开发了一个有用且实现良好的工具，请考虑通过提交问题或拉取请求将其贡献给项目。